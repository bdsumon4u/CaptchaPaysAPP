# Check out https://docs.codemagic.io/yaml/building-a-react-native-app/ for more information
# Please review and update values

workflows:
  react-native-android:
    name: React Native Android
    max_build_duration: 120
    instance_type: mac_mini
    environment:
      vars:
        PACKAGE_NAME: "com.captchapays"
        CM_KEYSTORE_PATH: "captchapays.keystore"
        CM_KEYSTORE: Encrypted(Z0FBQUFBQmc4VlVTYnE3WXdSbE5kN25UU1RZd2VNOVhfN1NKc21oY1QtOUxiaFJvVURqRDNtbERUY0RpVUh5aGdQY0RFdDl3cDJBa0dGTXBkOGQ2XzRMM0JLTGhBVm1nbDQ1bnFHOVhIVklIUjFrSzJBM3hnOGl3QnhBcmZuNUtjbldPbmdnWjlVUXkyZE14YXVYUHU1QjB0OVhtYWJ0ME5DZjFUMC12R0xiSS05aEl6UnI2ZlBrMzdYQzhsb3Ztako5TWJtZjk2ZFVCVmcwUmZvQWFDWUVTbFZZV3JpMEMxcnFSc1gyZ2lFSlpnbXJ5bk05Yl9YekNkV1lLVDNHelpSWTVqb085Mk0zeWlmb2twNjViLTk4NzhWczI0VDkwejlXZFNncFlUSWhwTlg5YjZaLThwM29SS3ZISk0yUlhObGtHdVdhbnd2ZW56cDJWRjB1R3A1Z2NvV0VPSlhmZndVUktFMTVPUXduQTBjYUlfU2l1UUp1R25iUjloMklNUnhqSHJaXzFsVV90S2RMcFRLOWxVLVM0bldacFo1dEp6b2I3Q29Pb2hueEpOWUZaMU8tYnF5Q2dSRjVDc0JkN2VFdDQ1dmFtVEtrQmVlSVBNRExZYXY0ZWZ5VUpiNjFpcVBnZEF6QW1naEdOdF8yQzY1cExBWE41ZDVYclZVYzhRSVFNZFdlOEtYei0waHZpN1lzZGQyZE1uUTMwbVF2enVKU2pwbGtGMEY2TFNwMWQ1X0dmc0tHSzlidGdzcU5uVjdaNXRUREdBVnAwemZIckxwYk13WVlnOW1MTUtuMnljQ1F0ZUN5STA0TmpKcEw0MlpVOENqYUU1YUFCT2ZrTmxPQnVmOUZobWVwNVRoOXdsY043d0g4MjVwQUF0WWo0NEhhQ1k5dnFxRTVBWDhad0FLTzJXbGJYMVdCQVFIbUVxb1J0M0dOdWJFTjIwYkV3XzBHUXhSWG8wT0gxdWQ0NmNDOXVHY3luMWFWN0FhNm5Hb0ozQ3VwMVRiUGRBQm5lbm0wcnNJMXVjOGQxZ3pmd25LVlhXR3JZZXZHaVo3d1lIOS1fc2Uzek55a2hIYlB3b1U4REt2RmZhS2JlcUZwOUo5cjg3dnV3ZVdWRFB2RVNMTkJuNVZXdFF6SmxWMW1LVGVfUGstOTJrdHd2UzFkZ01QdVhpTEpiS3p3Ty1qT3l2MEZTX29YU1JTdFp1NjJDS3BOWU1ITWh5a2hvenRfNHBlOEV4SXJZZk5mSUVWSkFBR2hsd3FfM3dJTnpMekR1NjI2SERmZl9RVWNZZDBndFFwYU9ocFFMZW5VQ1hBa2hHYy1JM25Bb2U0aWZlRVp6UGdlQXFkTjg0V29PM2cyS2RZX1pORWhCSi05X3hodG1JMy0tRjFsSElFQTItcXI1alVHdXNGeWE1dmZpTVdEVVJrVm5DeTRXOEk3aW9WaTZybnZ4Tnk2NktIMEs2N0N5ODRHVnhGZndDY1ZKWkZmQTA2ZEYxeE4xdTV6VVBWUXJOMVJGYXM0ZDMwQlpsRHFiTjE1bVFMYzRMLTEwb0U5azYzeEJkSE9BVzg2bWlnRU11Q3pzdElNMklOMzRfMnlkOWtodWpVdHljSUNnb1EzUjAtcC1ROVFlelh3aTRsWUw5VlhPWi1UQW1Nclhkdk55Zk90bHlvT3hlRm5ITzRnWklza0VReU44ekZKYXU4WFVNVHlwSDRMZkNlZEpMMWN1V2xuYkJtV3I4a25TTG9ENkRjZngzcDNFNENvTEV1dFBYaHBubVJuMmNCU1RZME1VQ01yN0tOVm9NcmxFc0dvVmpLc1NwUTNJaUpQS3lYNnNWWWhYTjVVVi1qNW9pS3RvaWIxTXFPRG1ZbGZUeDJ6VEFMUzBNckVPSlFyOUllTlF1aVlwNld0VW9XMVR2Z0JXYmNnaThwTEMxZHJic05pb0VDZm5hbS1VVnB1cEFNUWhWU2J0eXdueFgzWGFWV25MZDlyQ2ZDc25TN3NMUE1XVktMZERHZnVOVmx0cHFRLWFremZIekszWEZUQmJaWDFvem5EMC1sUUYzUjA3b3Nyak5vNk9uVEh2N1p0bnhjQTlaLVA4V1FxdGxMT0MzYlE4SllsZ0NQVVpWUWNzdlctQXZfRzFub296aFZJeFFQaEJ0V1RJMnVKQkxnUFRncW0xMlctNlNkcnp3MXhaM3ZwdUV4MzBHOWg2SlBqT0xDS2h0Umt3N2JaOUFadG12MVRUQUhjaWk0RlR4Q3dwQktTcF82dmdLWUR3LTVYQ1liRVNBR2x6YVloaU9ld3ZLbzIzdjl2dUJmV3Y3d3FQWVMzTHBjdkFqU21XWVRzQ2x5VngtNVlwSVBWX015WUdqWjByQThTNjNxSUdEc0ViTExQLUxldERmUDNIakRHODJEdTBhTnQwSXNDN1FFXzBacVVpVkR1NTdRNk1zdnF2V1Z4NVpranhZdTZUNGhWQ0h0ZDlYc29WanhzdUF6V1dKZjRYdG1ReDluelJMNkFlX01hZjFrcjRwRFlEN1RBRGtqLWNtYXlsdlZ0QWFYbm1iX0RTU2FtMkhVZmUxM3Q5VVlFU2lZT0RtdUZUWElSNDdLTGRabkZnWU5LN0FPcFFhU3N5cUdOdlB3ay1aQTlaUUNmWmh2X2N5dWhjeDdrb05vN3BUX1hNcUpBZUxHSDhwOGFFb1BvN2Z1b0t3bzFNS0xaLTBmaGVTdHJvWk5yWjVQRkVVell1WUEtd3E0WGF2SXZSOXc5MTJpNjREb09EdFAwOWt3ai1pTUVYcWpsVTZhbVdtVndwQ09aNVVKLWZZcGFRbk93U2QwV2stNjBMZGUxR3NPc2Y3SkU2QVd1WU9UTkI4bU0zbUl1dFF4TUFnSFdYaDcwc25sa0cwRjF0RTVfX050LVU2ZTFYVmppcldNaGxiUWtzYm8xR1lUY0oxNzNyeVFQRHIwMnBJcTZTd05qZlU5WE1La000YlFXX0M0QzJHRXRQR0l6Y0pFaHg1RmR0XzFMd1doS1F4WVZ6Y0FCLXNTaldza2hvLUZyWUROLUpBOVhwZTBuWlNCYlQyQVZ0cksyOTBDODFRTExKUFl4MmtIWG92S0JwazRjVFdRSk51TkNDVTVaY1lJZ1VRcnBtTVRod0NYamhUUkduOEp0Ry16QzVha3U4TG13WUtXSXpNbkhlcFFjd1BaR2p3bE9CVk1zRGFERER0TXhSZVBVTERHcGhJOWxRMGVNWDlDa1pRSlB1YzF4clVocUlWYUoxOWpVaUlkZkY4SlAyM2tlcEp2T2RqeERNNThoSTRSTkdHcmFqZkdzNTdxOWdpd2xQLUhpYkh1bFZpSzZwVUlzS0Q0aXRjUmItSTZ3WHFjYkxUZTRsX2Y4MDNReFhOQVVZWWdRbFN5TUtGd2xPeXN3cmtQYlRyRnNmbnBZLUhQVlhrb3loTXg0dklDeWRHZWpOTTk1TG9WNm5Dc0JFYko2YzhDRGcyQWpjY1cyS3M2ZDNvRUtoSHhaX1pjYk5Jb3JlMDRqdjZOMlFWam1HcVQtYUx4bDRnQk8zNHplOVhfWmJuSF95ZTZxSmt0N3lxNGZjc3htXy13LWl6Q2V6WEtSRmRwM2lfbGlQckpMZ3hYTDRPY2J5V1dGS1dOLWtMT1I2cUlaWnh6S2JzdzJmWFllM3JOUFFHUHZLdzVfTXhMeWwxUlIta0hEZmNzTGljV2JCYXdZM3pWdHZJNjg4UnI3ZG5DS2E3WDllNk9GaUp5eHo3MVRiZ2RPWVlxZDNUV1BjdnVPU2Z5MUhXM0tWZFVDNkp3Q1o3ZGsyZ1JMR2IzdUlYU3JManNtNWNCTlpoVDFyVnpuR3ZQYXE5cHd1SzdtOExJTTRwWWdGc0NTdzhjZ1ZzZU5fWENabTlIOF9QazdJS25hRERTaC1idlpUdENNTUVIcjBxWHhXSl8tSTVUMk51UFNVdmpxcnFHNUxTY3k0YkNwUnd4TVNwOEpWS05QTjBCcHgtTlhHZ053d0VBTGc4bjFxV0IyTjRVenZ4Y0xxeUtackFKWVc2Vmw0MXVHVzlaX3JVcEJHTHM0d3QxQmx3ZmsteS1zR0JESkFSRkZqcjE0QTFwSGVYS1hMTlNkdTNvWkItNjR4a0xDcldGdVVLeUo5dzQ2VEo1N29yTkFqQXE2MjlHN0dXR0VPeFJtS1otcl9iY2djQUxXQkNJUzF4TE0xblY1NW5NUE5NdmpnUjctc29HblZRSUk1bmRjeWpybmNLcm1XTDlpM2MwdFp4aVcwMzNTQjFuMHhEZ1dGcExtMlNwUUhERDY5RnhySWYxaGNSdFF6VUNUa3c3bGpmb2ZQQ1N1SlBEM0Rra2FjVlVWazZKQlAxb0wtV0VMOWVsQVFsd2RPOVhlQ29yZGZmRzV0RXdZTGJLODB5am5pNFl3bkdtRWxacldodVdMV2lMVE5xY1p5cDRTRWlUWDFjUXBtS0JDRXJZMzJQaE14OHdmR1JSMFZNbERDbmFuS3pJUzFYLXI1MkRPMU5fZnZSOTYxd1VPazRIMmJuTTZtN3RJdURRSEU1NUFidl9qN2xSTTUwR0NaZ0c4Vm5iVEJiRi0xRWo4WVEwS3poSmdCb0lWbmtpTGlLN2NsZ0EwR0dQOWR6SXBFVWl3TTdTSHluWGs2TWg3OVM4V0xiU2tfQWFhbkp0d2RmUVRJNVBjdi0xOTVIdTVZSERRNVVSRGlCczJXY2dERkNuRGdTdFhQRU4xSFlLN0ZEdkUzQW1LbFYyMndrNEpJZDlRajlQblBlaWh1VHp0WmFOTnhzczVsb05OdXU5S082dFptLUZReElsellma2JwQlAzT2hReEQ3am5NeENoOTJ0aFBrU1dXNzNadTlBa3JzWnRpVS1ubU5fRlRSMmNHZGVWS3pmcDFGWm9LTmtja3NZaHVVdmVXV3k1UnliU3ZaNGRVVTlJYXh2N0w4WHQ4VklxUklQU09Wanc4M3dLdWdLNWszVUhaVkxHaUFRTmdheE5qOFM0cHA0dlY5VjlLVVoyNTZpMGRBdjFaejhjc2FLZm5KR3E2emthSGVCOExycDVnRFRYWHVxbGpYYmlGcmIydVl6eEN3RXZnTEdCWWhHdkwxclc0LUVEN05pYW9aZnB1YkduSWN4Tm9yZDBFWGp5VWNVdmwtaEI2VlVycGFJNlVxZGlNWE9PR0JlMUlsZzlwV3ZzSDZVNTR0UUhyVE85dFV0Ty02NWM0YVJLWjBWYnBqRmlXVmRJaFY4UHdkdklwWU1Wcno1UmcwTDRac3hlRW4xRndvYWV3WHRpamxVeGdFckZraHlSa2ljWGM3UVd5RFVHZGprMmhWLUVua0xuMk5lTFVXaExqeUU5V3BZcThoTVZ2Z3gwUE1iTGdiNG5TM0ljbHUwa3FleXJrdVFmZU1pc2ZfeVRHQTNGRE9xZjNScVBxXzZUQ2pfYzU1YTQ5ME90bmh5V2otb0ttLUJDbkoxWG1DSFFISUN0S0VaSGRlUWZoREMwZTU2b1JTbGpnVnlCd2NrLWwtNmYwMmY3bTg3Ykh2WGdRTzZ2c2ZWZHpyaXo5eU9xWWlTM0JyU1BFOXRuOVdrUU5Bay0zSWlQaG9wM1EzTGhmSk04TEZ0cGtWMXI3QVJQeElWWTVuaWFWX0wxSlVvRmRVallOX1Z3WEttRmJPRnp1U2hPaXUta2V2ZnpiVWlEdGdJRGVnbFBRcFlaMDVzVjg5NnYyaF9MVzJXUzBCXzVWelVncmhmU25Vcmh2aHBmTlVFZEE1b29DQm55VUpUbHlJOGpvM3NPN0FDT2ZoM1hlYVRlUWRQSlU5enRrRktFbklsQzNyUTNRT0tGVUh5SGdFRTlkOGxMSW5mdXdiXzZqaWdQVldEdm5DQVYzWGVkLWNsXzIzeThkdkxsYzhvLXhGUENJWHVtUW1na3FUT2lmS3Q4dUJoZmxnM0k3b3VSaXk2RnUwQ1I2OGszbUVRaE45LVA5TF9WU2xMOTJoQ2dsUElJcnhKWTIwWlRzMW5QbUhLVmt2cE10OHMxZkN2SzFXNHhNRGxWa1RDTVlFUDRLVmVpazhVbU9QeGZsWTRpcHhpQmMtUi1McEpLUmVRdGUyWGdscDM2cV9qa3FIbVZCQTdyT3NHekd3Zy0wekVqVE9jNkl6RFpSSzdla1Jla3NyeWJZekp4ck9sT0E2MUJPa1Vod2tTY3pqcWZxaTVpRnZVX1N5RUtNVEROMjJaV2RXS2VQdWJwcFhFX3NkOE80UzBKVVZocEdJZXAtU0Rpek5lMmJyd2J0Z21tOGN2RHhpTlVMeHN4VXJDZURvVTRLZkYtNTBJWVVQQ3dralNsZTd3aV9vaUJBWHBlemxlM29HcWFybGswMnIzaUdMcGRfYncwPQ==)
        CM_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmc4VkhSYlN3bk80S05ZaEt5ZWQwUkJxbDNDUkY5aThfcVpfTXNjZ2NsYW9sTUtuMHdJY2lkZEN2OXJPenBVTzhLMHB5dnZkYVhzcW1BQmo0M3N6dVlUekEyZFE9PQ==)
        CM_KEY_ALIAS_PASSWORD: Encrypted(Z0FBQUFBQmc4VkhSYlN3bk80S05ZaEt5ZWQwUkJxbDNDUkY5aThfcVpfTXNjZ2NsYW9sTUtuMHdJY2lkZEN2OXJPenBVTzhLMHB5dnZkYVhzcW1BQmo0M3N6dVlUekEyZFE9PQ==)
        CM_KEY_ALIAS_USERNAME: Encrypted(Z0FBQUFBQmc4VlZWZFdiaU5HV3dqTEU5Tmw1aEZVZE5YeFNyWkRXOUswVDN5cjQzcHQ1Sml2NFRDVzlVb3BaeXdxNDhqOVl2NXoyX2tYVXNsYTJfcVJfcjJzQU81NVViMVE9PQ==)
      node: latest
    triggering:
      events:
        - push
        - tag
        - pull_request
      branch_patterns:
        - pattern: master
          include: true
          source: true
    scripts:
      - name: Install npm dependencies
        script: |
          npm install
      - name: Set Android SDK location
        script: |
          echo "sdk.dir=$ANDROID_SDK_ROOT" > "$FCI_BUILD_DIR/android/local.properties"
      - name: Set up keystore
        script: |
          echo $CM_KEYSTORE | base64 --decode > $CM_KEYSTORE_PATH
          cat >> "$FCI_BUILD_DIR/android/key.properties" <<EOF
          storePassword=$CM_KEYSTORE_PASSWORD
          keyPassword=$CM_KEY_ALIAS_PASSWORD
          keyAlias=$CM_KEY_ALIAS_USERNAME
          storeFile=$CM_KEYSTORE_PATH
          EOF
      - name: Build Android release
        script: |
          # Set environment variable so it can be used to increment build number in android/app/build.gradle
          # Note that tracks can be specified when retrieving latest build number from Google Play, for example:
          # export NEW_BUILD_NUMBER=$(($(google-play get-latest-build-number --package-name "$PACKAGE_NAME" --tracks=alpha) + 1))
          # export NEW_BUILD_NUMBER=$(($(google-play get-latest-build-number --package-name "$PACKAGE_NAME") + 1))
          cd android && ./gradlew assembleRelease
    artifacts:
      - android/app/build/outputs/**/*.apk

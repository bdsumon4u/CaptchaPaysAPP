# Check out https://docs.codemagic.io/yaml/building-a-react-native-app/ for more information
# Please review and update values

workflows:
  react-native-android:
    name: React Native Android
    max_build_duration: 120
    instance_type: mac_mini
    environment:
      vars:
        PACKAGE_NAME: "com.captchapays"
        FCI_KEYSTORE_PATH: /tmp/keystore.keystore
        FCI_KEYSTORE: Encrypted(Z0FBQUFBQmc4Vy0tX0k2RUZ0ZDZGV3VULUtsWVE1SktqZHJKRXdTNE5LQV9xbVh2RlFvS3RNd2oxWnI3V3dZSG8zaXRFLThqT3lqbkN2MTQ2cGpsOVo2ZzBhS0RlMHpnbE5Bckx0M3NJbWRNQVlqQkpIS082cnNlc0V5dEFDTUpxT1FoenhEUXo3LWtoLUR0UDNrY2RUY3JUVU5LY3dyc0pWb0l0TXpPcFQybFlMUkp5ZXYxbzN1VFRFOG5GbVc1bzJfV2Z3bVpmV3V2Nk8zOXRMT3JjSG1jRmQ5S3FMSFNGb1doeDBpTTlITVdVd24tdzUzbTRYaWZ4eEM5eWRPbW13NFF1ZlBsQm5YMmJ4NjZPREVoODhpYjF6VnBRclN4UVQ0V3g0TFliYWU0eHZQRG95aDFEWTQwdXk2YUNiaDNqb2JJRHhGTS1scTc1ejh6ZlVVM3NKbklyVEdvb2lmTE5MQ2xYcjhxNWVZWHpVbS0wUURSLURBZXh5al9jQTFWbV9uUnN4NFRlTmphVkRHOTNVN2xhaERuR3JlaFFnUGZDZTZxaXd1aVdRcFBpcmkwbVcyTzBhOU1MS29CV1IwcU1yakJqNkg2MTRBb2E4dEUyUnZSeTZLdl9KQ2xwN1VkZGtnUUJiLU1HaXhLTnZxWGtHU2l5NVg5UUNyTmtOTWpGT2ZkeGlCYTk0Ui0yVkFPNEQ3QzdlaGNFWUlVSTNFcno5dkpJWWJNWTY5WFB3bUdOdmxTMU50akNpZlRyZVJvSkVGZ0dfcUhaOFZ3ckZQdjdSQi0tRFVUSDFWUUcwaHpkV0tWR3JqWi1VLVZ0WFoxT3RWWmxGMDE5Vkh2RURXQWxka0xJazNpMHJMRXJZckZIUG9XNV9Ed21aN2Q0QW1YUHV3QU1lTkNGMDFkTmc2LWowRFdfZjFoWld4d0d6UDhTTHA2WGtNSTUwVk1vdUFybk5zNkVMbF9RSkdsVGtjMTctZ25CbDlqY3RYSW5FRjVybW5qakJoV3BXWDM2ajNQd2dGNU92aVVleWJXZjI3alFNMF94N0R4YXdLOXZ2U3VhcGZkSzZDMExNemhDQ2x1MU8tb0pDcmtjbE9sLU41OFYxOXFMbGg3aUJvSTMzcWZyUE9jNWsxSmdOZHN1RjBFWTNFdlJIbElMU3JqM0d0cjFoSXk0Xy1hSURUcnpZS0p2eG9JVTI0d2FmeG8tMnVsTEZGMUNSd29rM2lHZkYxN2Z6RlpuYVVIbHdqYXdPNHBjazQyemY4cXpaT2xJVnZtaXFtT29YcEdNZThhOHhoVkREQklQU1h1TTNpUlhMTTJxSXF3cVd4cHZrZmlfeHRTLUZZd3UzNjdzVjZBMjZmc3JhQ3oxZk9kWnN0QXNMREtNZzBNS05XdTU3SnBIV29FTWJtMkQ2SGwzTjY0Q3BLbkZGcXg0ZVpjRnh0dkE5Tk16QklpclVpb1IxREJENzlDLUVBMndPNTdHWkZwVE5YcHNzclpISU9wM0JVZVpKTXNMQ2xLc1hrOG0tbjdyMk1STWVtZk5LN1M2d095RlY3N1pxYm1hNkhiVGFURkM3R2tHX0VRa3Rib3NxSThMa0FpZzIxLUZOcG9HYnc3MXI1ZnQwazRHcDBWNU12S0lVTjQtbFlSSjNURmtLZ0xocExMWTEtZVgxSzF4WF84a0l5OEU1MER2RFFGVjBaMnB4VThYVDVUck1ZazNLY3pYclotZ3REYWNoWk1LdWs5UGN5SHlubXJSbnUyNzJJODhieTBUVElBMUp6dnViRzQzTFRWMF9YeTBzMEVld3VoTGJtbEViU1BEWHR1aXFlMWdmVWhMZjBacnVtbTlNOFNBeVptYmc4R3NwLTV2ODRhNnYteGxLYkdidERuVVpTU05qd0tIdWRYa1VyaEk4WkxyNkhKV1JVRmVqVzF3QXJwcXpGZ3hyb2hZMWlBS0Z5ajBoZHFqZWJPVmdMeHJsdlFGdUlrbUdOUFdYZ2tXRC1kSE1YNDJMZ1poTjcxUXYxOGRLYmdST1ZOelBIYTZZTVBsbzQ1b2ZibHlaa3NDMEZrT252Uld0Y3cweGVRTm16VzRmc3l4ZUl6N1d2MFJmUzFHT1YzSzNBcE1wekhuX2pBS0E0YlBNcFNnbU9xQVZNb1YyY1Z6SmtLNUJfNUVrcTRDV3ZPZmVxVWE0Q1dydzZZRkpJbEw2R1dZZmlfdDhJZ2NLdG5PSHFCdy1oc3p2R3M5d1ZDSnJWWjVWWVdmWWZZWk85cXVjUE9rZmlXN2ZSeG1Nc2N3ZExkMmpyeWM3dklaOTA2YUlhLXNrX3gxQXVDY0ozN3dSUC01WnQ1RDU3VUwwYU5MeEx0a3lPWUFZWDR0Uk1Hc2xGeGhmOVNBZWRIOXJSbVQtOXVqSGJTQ3J5cDRwcmJEWnBiR05Xa1F4OHZsX19PbTVwcmdMTXZINFMtbWtpVHRybFVBMVkwekM0Qkx4cEN2SW5sZmMyR1VOenpXaG9ReS1hZ2dSY2RHekpMVjJ5WGVLR0lGcFdQYmVzbmlhcnBnLUtobUlwR2kzV0ZHRTY1U2d2NExQMWtuTHRKaExwdi1HeGNaeTJmZXkybWF6QjVJM2wzWWJzZDV2elVDRGpCZXRZMnRtQnFiS2YzN19EWUxyNVRNbkdaMVYydzQzMk0waGRwMkhHYUl6LUEybjhlcGJHMXZvTWpnMEZxUnkyN1R2Q2l0dWZCZ2FRRWwza1ZMODFqWDRCVVNXaGp6enZkRWYweXE4NjdTbWJoYnBjN0xrWFFJVXBlUENMUTM2TTJkcmFSa0szUlMzX251UndHZFF6TGNmSGJsWHZKakFOeEdTNGg4elRDdENPdnNIRFRHTThQdWVIQ09LVjAyY0R3bnBldDIwMV8xc0FSZnN6VHhXRDZiVVBNMVZHOEVZWFBoaFpJeXJtX0FJeE1TNF9mR1lNdTlsRDhDUTFFdHlJWGlxbExzNVRheE1oTXUzMWtQRnJIZkduU2M4WEYySWFtY2lDZ3pLZVVZVDhJeUlWcV9SUkVUVEtSWGZhcTJBazhKTVJsR2xZcTk5eGZzMnJIUXk3UWc5WnpidUtYZWVMS2ZsVnJMRDFYVEt2UEMtTUVtazhqODFxalNNV19GLXdVcXJYbFZ3NXF3dElZZXIxX2lhTnNjT2k3T0VZY2d2SE9lOGp6dVoxclZ4Q09tVkZEbktTN24zSHhXY0VOYjRReml1U1JYWXZnT1c0SWZLRm5wLXdaS01EcXNJeEVaZ28zcGdwdl84SnJ1OUl3REdfZll0dkhyVGtra1RIMnFUd2Zncl85U1ltZU1HSzA2bVduYW1zTjI0M2pxN2tqMzBHaVE5UDh2YWZDekF1U2ZZMzcxV0JUU2tYd2Z0V1UxUkRfV1dTdGIxZnpGR2FxYlBHbVdQai1BQnkyMTdncjlLeTZmOFZCMlJMOHkxOURiLTMxNjI0eF9LMExBQUtuMldiVXNMSnM1YzZyWVFPQXZQcWc1bXBsVnNGb2ZQTjJ6VlhjS3BZdGJlYWhMMEpldE1qcG0xbjVpVGVRT0twdElweVlqc2M3U0JUY3liSE5YVnVfSmgtWlk1SFVRWDYzLTl0Z3NTVlRBRE9WeWtIR3EyYUZNb3luOFFTa1NDMnlyamZYSFMySm1nMVRWejN4Y0FlLVIzaFd2a2NSUmczNWVSQ094S2dBaVZhVldCNkR3WWdKckEybjhzNHFISnRXS3R6Q3hkWDdiSDlmY0hBRHk5RUFjdWtiVE5NVzlKdEVINHU2Q2JyamNON0kzZ0JyRmk0RE9WRXlsdW5ZZGl6Mzc3UVl6SnlRazlJUUZiVURjMTd0d0ZoekpEamgzM1R4bDN1eUR6VG9NR0J1N2hVR3gzMVkxb3NIcUEtOHlJZnd2ejFSUWt4ZWdpOGFsX0J6ZFJ5NUVrMHBkWG5Jd3ZVeVRrQ1dsSG5LUDUybFlzZ1gyY2dnNzdnOXpFNnduQUlqdW5LVVZETXZjME94eVdBa1BlTjN4eVpicV9RemV2dmlibkRRbGFOUThseW5oY1RfSjhQU3c0R1U0WHN5X0dCZ3NXOG9PajFFNW1RdFFsLTZpcTBoQVc4VFpRakRXRDl1dUpER2JrLXpUOEJSZnhRZjgydkF6cjhmTkU2MjNkN1Bkc3FvYWdWS2JsNTF5ZTVVRGI4UWd6OFFWQ2ZzQ3pZdnVwSTFoazh1elZWUUJ6YXY5eUJSM1NYR2Nyd0V0bXEwbnY2ck93WWVOZ0tPVU43RTNGXzgzNTlSc2NuNm9DRkVNSndkaWYtb1FQWF9wQUdqdlVqT0MzVWd6Si0wZkk4ZHdvUnd0Z0MzUFRmNzVwMWVadFpVVzZBMXFnODZaci1TNUFjeVpoR0VGTzUzVEV6UTJsTTF2ZFB2dWloMzVXU016algxM0kydXk4V3dLbkxOV2NxWFlIU1pIYUtGazNWNWVSZmZyV203ZG85T1Bpa3JQSThjLXl1SUJvMVB4cl9abl82N1BvRkpka0NwTUg1WGZaVGsxR1FFcC0xbmNnNTQyb0xFRW9DY3NBUjl3U1dUY0tMZWFHTndkQ3c4YzM0aHBvT1ViRXdPaTdZZ2Rzdl82SUJid3lvSEJNMTZaWlRYZmVnMFFIb21BYUtSMmRZRWxFcHM1MEg1bmlBbDFwZnE3QnVhVHFXWlY2YUJqMm94WEFaeHRyYVNidEVTZFlNaWt5OEtCYnF2eEdMVElVR2ItTUttMkFuMGpvNlFmT1BudHgyN2VDSEhnRGFPRHE0SW9adFh3eWJvQ0RtUVdCMm1BQWE5Yy0zbUZIRy1kR2ZPRkpNeTJQdy1wcFVCbHlHS08xLXFKeGhiRWpSa2ZWdVRtaHBVUHgxeUsxWjl2ZXdzeENBRWo4ZjdpTTQ0Rzc5OWx2UTZ2RGxqNzRCU1RsMlBDeXFMeVpxUFRCdTN1eGg1cFJKM2NKWWJmQUpVOWF0VldQWTN0dTQzRjN4OXhXczlLb2pOc01JTmNWa1d3cGtEdmFHdFdndnFWWUhCa0dvWHBUOWtvaVBMYnBzS1JZVVRWR2dOcVU1bmtsampSVnBhdG9Kb2FHcTRLV3VDR3dUTG9iYnJKVS02UF9LMXN0WGRuc2RzcGtDZFFkR3VOWlUzX1dSMDBrUmhNYUNJVFJxVk5sV3dzSjhaSXU0X3ZJV29DejJRWktfOTNwb1FXZG1NTkU5eExqdUNhV1AwRHd2NFNWV29tUjkwLXM3d19SVXZrSVh0c3hIYVpIOXI3VkQxbXBvSkRCVTRzYVZPNTU1SUR3T0N0WXhkb0dxX3dQZnJBd1d0VnRwQ3NXR0hQT3Q1dmdVU1p0TzQzZlJQQmhsaUVpWkkxbm5wM2hHa0x1WVV6eEtvTmNGdUxJdThaZnF4Zmd6MEtoWnM3a3R0bEI3RjBPUmNDWC1jZFl3U0s4b01hMHp3MmFsdlBrUmpGRjlTcVVQbnd1Y29nSG9aQmdPd3hScTRDS1ZCRG5qYWlmTENDZjhDUk1fWWhaZDR4dDhtT0FJcVdBb3VTSEJxb3R5N1E3OGpmT29JR2x0ekV1MGdKbXlWcVRoVTNxN3IzamE2LXhUVERUZmptN05uaHF4S3dybnFCaU1ZNTNlamR1ek5kQVI5RVRvV0hYTmJyaE4wSGJyaEJ0azFfWTVVQVVCeFY1UUU3WFEwaW9iUmcxdWN6STctTUpjQm9UbGoweTlidzBqMUV1QUJRbmt1Ul9rbVpGYlplWmw5d0xOOThKMVlRRHd1ZnlhWUhEcGlwZWd3WTRrT2VKa3V4RWxHWlMyaUNjYzNEYkpXVVRpQUlIY2tGNG1scWlqUzBCWEpkVGhlaUgyMFdrVkV3bU4tUWk4QUZqRnJGeXhCV0xvanhYYzk4QnlUYURPeHR3WktBNVI3LWRRM28tTkpfWHVybmlZd1R0d3F2S3ppM3VRU3hrYk1wdmpzMkVtUGdCWGdpZy1aV0JRYlo0OHI0MkJhbFN1LVVtQ0g1VmViOUZzQVpDbDFIdnYyM2hJWjRqWHFFR2hoMklFOWxRZ0s5WV9qV0FwOGRjeWlhenIwWlpsN1FuV1ROTW1nTDkyZ3VLOXJrdzhwaEZ3SUFkVWVUNS05T3N4M3gzVlVxelRTV2lYU3ZsbTNJSzFrV1ZVZUh5Y2dOb0VLcE9ZYkRuc0pGemNtcm5yVzlFZ2FUTUJTTXE0eXdZVDNZU1h1dDZhZERIQVFqN1E0TGhKbUxRdmRsQkxXWW04U19sQWRBS0dXTzRRMEFURmhvSlVoTEdNUXVGNlhadldPc2lBUktEWFFzQzd6M05sbWpJUmJTM2NhQmdDdXNJczJKblRTb0lKZHo0ZkIyQ2dJWW9USkZ6OXpTMHBCdmtZTjJaSFhibDlWREZZPQ==)
        FCI_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmc4Vzg3RG9EZlRsUDZpc2I5ZnN4Y3RYakpPSkR2ZVNUVkhwTDYwN2JaWTZrV1BXTk43MnlhUkF2WFAycnk5bmM0R2VPNkNpX1BVcW5NTWVEN2Q0ZmFaY1NjcGc9PQ==)
        FCI_KEY_ALIAS_PASSWORD: Encrypted(Z0FBQUFBQmc4Vzg3RG9EZlRsUDZpc2I5ZnN4Y3RYakpPSkR2ZVNUVkhwTDYwN2JaWTZrV1BXTk43MnlhUkF2WFAycnk5bmM0R2VPNkNpX1BVcW5NTWVEN2Q0ZmFaY1NjcGc9PQ==)
        FCI_KEY_ALIAS_USERNAME: Encrypted(Z0FBQUFBQmc4Vzk1WGxCTDE0QnRvSVRVQmpYRmZTNVFWVGJ4VGYwSVRWR3dKOHpIa1ZlRjNoU2dVRTltWjh5MDd0N29fWjNkdG5uOFRGYUVzeklKb243Y0x4SVJUZmtTaGc9PQ==)
      node: latest
    triggering:
      events:
        - push
        - tag
        - pull_request
      branch_patterns:
        - pattern: master
          include: true
          source: true
    scripts:
      - name: Install npm dependencies
        script: |
          npm install
      - name: Set Android SDK location
        script: |
          echo "sdk.dir=$ANDROID_SDK_ROOT" > "$FCI_BUILD_DIR/android/local.properties"
      - name: Set up keystore
        script: |
          echo $FCI_KEYSTORE | base64 --decode > $FCI_KEYSTORE_PATH
          cat >> "$FCI_BUILD_DIR/android/key.properties" <<EOF
          storePassword=$FCI_KEYSTORE_PASSWORD
          keyPassword=$FCI_KEY_ALIAS_PASSWORD
          keyAlias=$FCI_KEY_ALIAS_USERNAME
          storeFile=$FCI_KEYSTORE_PATH
          EOF
      - name: Build Android release
        script: |
          # Set environment variable so it can be used to increment build number in android/app/build.gradle
          # Note that tracks can be specified when retrieving latest build number from Google Play, for example:
          # export NEW_BUILD_NUMBER=$(($(google-play get-latest-build-number --package-name "$PACKAGE_NAME" --tracks=alpha) + 1))
          # export NEW_BUILD_NUMBER=$(($(google-play get-latest-build-number --package-name "$PACKAGE_NAME") + 1))
          cd android && ./gradlew assembleRelease
    artifacts:
      - android/app/build/outputs/**/*.apk
